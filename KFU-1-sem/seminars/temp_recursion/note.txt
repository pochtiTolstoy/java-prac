Задача по скобкам с рекурсией

Можно в стек
Если открывающая, то пушим в стек
Как только встретили закрывающую, то вытаскиваем со стека и смотрим, Если типы подходит, то ок, иначе,
Ошибка.
В конце должен быть пустой стек.
({)aa}a[]bbb{}

({aaa)}

Как переписать стек в рекурсию
По сути рекурсия вызов функций, которая переписыватся на стек.

int is_valid(str, idx) {
if (idx >= str.len) return -1;
  if (str[idx] == CB)
    return type[str[idx]];
  if (str[idx] == OP)
    int code = is_valid(str, idx + 1);
    if (code != type[str[idx]]) return -1;
  return is_valid(str, idx + 1);
}

is_valid[0] -> is_valid[1] -> is_valid[2]
                        0  <-

({aaa}[...])

Если открытая, то запускаем рекурсию от следующего символа. Ждем, что придет код закрытой.
Если просто символ, то запускаем рекурсию от следующего символа
Если закрытая то остановка рекурсии, возвращение по стеку
